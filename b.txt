local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()
local Window = OrionLib:MakeWindow({Name = "Key System", HidePremium = false, SaveConfig = true, ConfigFolder = "OrionKeySystem"})

local accountId = 42762
local allowPassThrough = false
local allowKeyRedeeming = false
local useDataModel = false
local localPlayerId = game:GetService("Players").LocalPlayer.UserId
local rateLimit = false
local rateLimitCountdown = 0
local errorWait = false

-- Function to fetch whitelist link
local function getLink()
    return string.format("https://gateway.platoboost.com/a/%i?id=%i", accountId, localPlayerId)
end

-- Function to show messages in Orion UI
local function onMessage(message)
    print(message)
    OrionLib:MakeNotification({
        Name = "Message",
        Content = message,
        Time = 5
    })
end

local function verify(key)
    if errorWait or rateLimit then
        return false
    end

    onMessage("Checking key...")

    if (useDataModel) then
        local status, result = pcall(function()
            return game:HttpGetAsync(string.format("https://api-gateway.platoboost.com/v1/public/whitelist/%i/%i?key=%s", accountId, localPlayerId, key))
        end)

        if status then
            if string.find(result, "true") then
                onMessage("Successfully whitelisted!")
                return true
            elseif string.find(result, "false") then
                if allowKeyRedeeming then
                    local status1, result1 = pcall(function()
                        return game:HttpPostAsync(string.format("https://api-gateway.platoboost.com/v1/authenticators/redeem/%i/%i/%s", accountId, localPlayerId, key), {})
                    end)

                    if status1 then
                        if string.find(result1, "true") then
                            onMessage("Successfully redeemed key!")
                            return
true
                        end
end
                end
            end
            onMessage("Key is invalid!")
            return false
        else
            onMessage("An error occurred while contacting the server!")
            return allowPassThrough
        end
    else
        local status, result = pcall(function()
            return request({
                Url = string.format("https://api-gateway.platoboost.com/v1/public/whitelist/%i/%i?key=%s", accountId, localPlayerId, key),
                Method = "GET"
            })
        end)

        if status then
            if result.StatusCode == 200 then
                if string.find(result.Body, "true") then
                    onMessage("Successfully whitelisted key!")
                    return true
                else
                    if (allowKeyRedeeming) then
                        local status1, result1 = pcall(function()
                            return request({
                                Url = string.format("https://api-gateway.platoboost.com/v1/authenticators/redeem/%i/%i/%s", accountId, localPlayerId, key),
                                Method = "POST"
                            })
                        end)

                        if status1 then
                            if result1.StatusCode == 200 then
                                if string.find(result1.Body, "true") then
                                    onMessage("Successfully redeemed key!")
                                    return true
                                end
                            end
                        end
                    end
                    return false
                end
            elseif result.StatusCode == 204 then
                onMessage("Account wasn't found, check accountId")
                return false
            elseif result.StatusCode == 429 then
                if not rateLimit then
rateLimit = true
                    rateLimitCountdown = 10
task.spawn(function()
                        while rateLimit do
                            onMessage(string.format("You are being rate-limited, please slow down. Try again in %i second(s).", rateLimitCountdown))
                            task.wait(1)
                            rateLimitCountdown = rateLimitCountdown - 1
                            if rateLimitCountdown < 0 then
                                rateLimit = false
                                rateLimitCountdown = 0
                                onMessage("Rate limit is over, please try again.")
                            end
                        end
                    end)
                end
            else
                return allowPassThrough
            end
        else
            return allowPassThrough
        end
    end
end

-- GUI Setup
local Tab = Window:MakeTab({
    Name = "Key System",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

Tab:AddTextbox({
    Name = "Enter Key",
    Default = "",
    TextDisappear = true,
    Callback = function(value)
        local isVerified = verify(value)
        if isVerified then
            onMessage("Access Granted!")
        else
            onMessage("Access Denied!")
        end
    end
})

Tab:AddButton({
    Name = "Get Key",
    Callback = function()
        local link = getLink()
        onMessage("Visit the following link to get your key: " .. link)
        setclipboard(link)  -- This will copy the link to the user's clipboard
    end
})

OrionLib:Init()
